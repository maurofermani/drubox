#require Qt4 bindings for ruby
require 'Qt4'

$DEFAULT_PATH = '/home/p4c/Escritorio/ejrubyqt/drubox'

#populate the tree
def populate(tree, path, parent=nil)
  Dir["#{path}/*"].each do |file|
    #fill item information
    item = Qt::TreeWidgetItem.new()
    item.setText(0, File.basename(file))
    item.setText(1, File.mtime(file).strftime("%Y-%m-%d %I:%M:%S %p"))
    item.setText(2, (File.size(file).to_s + ' bytes'))
    item.setText(3, File.dirname(file) + '/')
if ( File.ftype(file)="file")
	item.setIcon(0, Qt::Icon.new('./images/File.png') )
elsif(File.ftype(file)="directory")
	item.setIcon(0, Qt::Icon.new('./images/Folder.png') )	
end
    #add item to the tree
    if (parent == nil)
      tree.addTopLevelItem(item)
    else
      parent.insertChild(parent.childCount, item)
    end

    if (File.ftype(file) == 'directory')
      populate(tree, file, item)
    end
  end
end

if $0 == __FILE__
  #parse command line
  if (ARGV.size > 0)
    path = ARGV[0]
  else
    path = $DEFAULT_PATH
  end



  app = Qt::Application.new(ARGV)
  tree = Qt::TreeWidget.new
  tree.windowTitle = "Simple Tree Example"
  
  #set view headers
  tree.setHeaderLabels(['File Name', 'Last Modified', 'Size', 'Path'])
  populate(tree,path)
  
  tree.show
  app.exec
end
